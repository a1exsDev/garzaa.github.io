<!DOCTYPE HTML>
<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,100' rel='stylesheet' type='text/css'/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<link href="dnd.css" rel="stylesheet"/>
	<title>D&amp;D</title>
</head>

<body>

	<div id="dicecontainer">
		<span id="roll-outcome1" class="roll-outcome">0</span>
		<span id="roll-outcome2" class="roll-outcome" style="display:none">0</span>
		<span id="roll-outcome3" class="roll-outcome" style="display:none">0</span>
		<span id="roll-outcome4" class="roll-outcome" style="display:none">0</span>
		<span id="roll-outcome5" class="roll-outcome" style="display:none">0</span>
	</div>
	<br>
	<br>
	<span id="d4" class="dicebutton">D4</span>
	<span id="d6" class="dicebutton">D6</span>
	<span id="d8" class="dicebutton">D8</span>
	<span id="d10" class="dicebutton">D10</span>
	<span id="d12" class="dicebutton">D12</span>
	<span id="d20" class="dicebutton">D20</span>
	<br>
	<br>
	<br>
	<span id="one" class="dicebutton">1 die</span>
	<span id="two" class="dicebutton">2 dice</span>
	<span id="three" class="dicebutton">3 dice</span>
	<span id="four" class="dicebutton">4 dice</span>
	<span id="five" class="dicebutton">5 dice</span>
	<span id="modifier" class="dicebutton">+0</span>
	<br>
	<br>
	<br>
	<span id="airhorn" class="dicebutton">AIRHORN</span>
	<!-- <span id="dm-tools-toggle">DM Tools</span> -->
	<br>
	<br>
	<p><span id="dm-tools-toggle">DM Tools</span></p>
	<div id="dm-tools">
	<span id="spells" class="dicebutton">Random Spell</span>
	</div>
	<script>

	var modifier = 0;
	var dice = 1;

	function rollDie(sides) {
		/* var outcome = Math.floor(Math.random() * sides) + 1
		document.getElementById("roll-outcome1").innerHTML = outcome */
		var element
		var outcome
		for (var i=1; i<=5; i++) {
			outcome = Math.floor(Math.random() * sides) + 1
			element = "roll-outcome" + i
			
			var elementId = "#" + "roll-outcome" + i
			if (outcome == sides && $(elementId).is(":visible")) {
				console.log("critical roll on " + elementId)
				playAirhorn();
			}
			document.getElementById(element).innerHTML = outcome + Number(modifier)
		}
	}

	function visibleDice(numberDice) {
		var element
		$("#roll-outcome1, #roll-outcome2, #roll-outcome3, #roll-outcome4, #roll-outcome5").each(function() {
			$(this).hide();
		})
		for (var i=1; i<=numberDice; i++) {
			element = "#" + "roll-outcome" + i
			$(element).show();
		}
	}

	$("#modifier").click(function() {
		modifier = prompt("enter a modifier:")
		if (modifier == "" || isNaN(modifier) || !modifier) {
			modifier = "0";
		}
		document.getElementById("modifier").innerHTML = "+" + modifier;
	})

	$("#d4").click(function() {
		rollDie(4);
	})

	$("#d6").click(function() {
		rollDie(6);
	})

	$("#d8").click(function() {
		rollDie(8);
	})

	$("#d10").click(function() {
		rollDie(10);
	})

	$("#d12").click(function() {
		rollDie(12);
	})

	$("#d20").click(function() {
		rollDie(20);
	})

	$("#one").click(function() {
		dice = 1
		visibleDice(1)
	})
	$("#two").click(function() {
		dice = 2
		visibleDice(2)
	})
	$("#three").click(function() {
		dice = 3
		visibleDice(3)
	})
	$("#four").click(function() {
		dice = 4
		visibleDice(4)
	})
	$("#five").click(function() {
		dice = 5
		visibleDice(5)
	})

function playAirhorn() {
		var airhorn = new Audio("airhorn.mp3");
		airhorn.play();
		airhorn.currentTime = 0;
}

	$("#airhorn").click(function() {
		playAirhorn();
	})

	$("#dm-tools-toggle").click(function() {
		$("#dm-tools").slideToggle(100)
		document.getElementById("spells").innerHTML = "Random Spell"
	})

	var spell1 = [
		"Flaming",
		"Icy",
		"Spooky",
		"Poisonous",
		"Electric",
		"Thunderous",
		"Water",
		"Psychic",
		"Spicy",
		"Massive",
		"Magnetic",
		"Radioactive",
		"Tiny",
		"Ineffective",
		"Weak",
		"Terrifying",
		"Sticky",
		"Singing",
		"Bouncing",
		"Spinning",
		"Homing",
		"Short-lived",
		"Holy",
		"Necrotic",
		"Elemental",
		"Freezing",
		"Long-range",
		"Unsettling",
		"Laughably shitty",
		"Miniscule",
		"Loving",
		"Invisible",
		"Stunning",
		"Misfiring",
		"Unfortunate",
		"Self-inflicted",
		"Mild",
		"Flaccid",
		"Petulant",

	]

	var spell2 = [
		"sphere",
		"sword",
		"finger",
		"foot",
		"wave",
		"fist",
		"rune",
		"storm",
		"cyclone",
		"whirlwind",
		"storm",
		"meteor",
		"rod",
		"spray",
		"cone",
		"touch",
		"punch",
		"shield",
		"arrow",
		"needles",
		"ball",
		"golem",
		"familiar",
		"homunculus",
		"spider",
		"touches",
		"rain",
		"cannonball",
		"geyser",
		"beam",
		"wall",
		"hands",

	]

	var spell3 = [
		"murder",
		"death",
		"lust",
		"chaos",
		"vengeance",
		"Kung Fu",
		"punching",
		"rage",
		"molten metal",
		"mind control",
		"spiders",
		"hallucinations",
		"violation",
		"penetration",
		"pain",
		"public indecency",
		"stupidity",
		"shit",
		"bodily fluids",
		"unbelievable fertility",
		"dirt",
		"stone",
		"attempted murder",
		"cold sweats",
		"terror",

	]

	function randomSpell() {
		var output = getRand(spell1) + " " + getRand(spell2) + " of " + getRand(spell3)
		return output
	}

	function getRand(arr) {
		var outcome = Math.floor(Math.random() * arr.length)
		return arr[outcome]
	}

	$("#spells").click(function() {
		document.getElementById("spells").innerHTML = randomSpell()
	})

	function setModifier() {
		modifier = prompt("enter a modifier:")
		if (modifier == "" || isNaN(modifier) || !modifier) {
			modifier = "0";
		}
		document.getElementById("modifier").innerHTML = "+" + modifier;
	}

	$(document).keypress(function (e) {
		switch (e.which) {
			case 49:
				rollDie(12);
				break;
			case 50:
				rollDie(20);
				break;
			case 52:
				rollDie(4);
				break;
			case 54:
				rollDie(6);
				break;
			case 56:
				rollDie(8);
				break;
			case 48:
				rollDie(10);
				break;
			case 13:
				setModifier();
				break;
			case 32:
				playAirhorn();
				break;
		}
	})

	</script>
</body>
<html>
